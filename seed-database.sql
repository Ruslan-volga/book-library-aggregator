-- Тестовые пользователи (пароль для всех: password123)
INSERT INTO users (email, "passwordHash", name, role) VALUES
('admin@library.com', '$2b$10$B9exYIT9GRfS8Rg/.z/hQO81.1oA8Ucqb8d6I8R.JYQ5b0wKjY3rW', 'Администратор системы', 'admin'),
('manager@library.com', '$2b$10$B9exYIT9GRfS8Rg/.z/hQO81.1oA8Ucqb8d6I8R.JYQ5b0wKjY3rW', 'Менеджер поддержки', 'manager'),
('client@library.com', '$2b$10$B9exYIT9GRfS8Rg/.z/hQO81.1oA8Ucqb8d6I8R.JYQ5b0wKjY3rW', 'Иван Иванов', 'client'),
('client2@library.com', '$2b$10$B9exYIT9GRfS8Rg/.z/hQO81.1oA8Ucqb8d6I8R.JYQ5b0wKjY3rW', 'Мария Петрова', 'client')
ON CONFLICT (email) DO NOTHING;

-- Библиотеки
INSERT INTO libraries (name, address, description) VALUES
('Центральная библиотека им. Пушкина', 'Москва, ул. Пушкина, 10', 'Крупнейшая библиотека города с богатой коллекцией классической литературы'),
('Научная библиотека МГУ', 'Москва, Ленинские горы, 1', 'Крупнейшая университетская библиотека России'),
('Детская библиотека №1', 'Санкт-Петербург, Невский проспект, 20', 'Библиотека для детей и подростков с игровой комнатой'),
('Городская библиотека №5', 'Казань, ул. Баумана, 15', 'Современная библиотека с электронным каталогом')
ON CONFLICT DO NOTHING;

-- Книги
INSERT INTO books ("libraryId", title, author, year, description, "isAvailable", "totalCopies", "availableCopies") VALUES
(1, 'Война и мир', 'Лев Толстой', 1869, 'Роман-эпопея, описывающий русское общество в эпоху войн против Наполеона', true, 5, 5),
(1, 'Преступление и наказание', 'Фёдор Достоевский', 1866, 'Роман о нравственных страданиях и психологии преступления', true, 3, 3),
(1, 'Анна Каренина', 'Лев Толстой', 1877, 'Роман о любви, семье и общественных нормах', true, 4, 4),
(2, 'Мастер и Маргарита', 'Михаил Булгаков', 1967, 'Мистический роман о добре и зле, любви и творчестве', true, 6, 6),
(2, 'Тихий Дон', 'Михаил Шолохов', 1940, 'Эпопея о жизни донского казачества во время Первой мировой и Гражданской войн', true, 2, 2),
(2, 'Доктор Живаго', 'Борис Пастернак', 1957, 'Роман о судьбе русской интеллигенции в годы революции', true, 3, 3),
(3, 'Гарри Поттер и философский камень', 'Дж. К. Роулинг', 1997, 'Первая книга серии о юном волшебнике Гарри Поттере', true, 10, 10),
(3, 'Приключения Незнайки', 'Николай Носов', 1954, 'Сказочная повесть о приключениях маленьких человечков', true, 8, 8),
(3, 'Винни-Пух и все-все-все', 'Алан Милн', 1926, 'Сказка о приключениях плюшевого медвежонка', true, 7, 7),
(4, '1984', 'Джордж Оруэлл', 1949, 'Антиутопический роман о тоталитарном обществе', true, 5, 5),
(4, 'Скотный двор', 'Джордж Оруэлл', 1945, 'Сатирическая повесть-притча о революции', true, 4, 4),
(4, 'Убить пересмешника', 'Харпер Ли', 1960, 'Роман о расовой несправедливости и утрате невинности', true, 6, 6)
ON CONFLICT DO NOTHING;

-- Тестовые обращения в поддержку
INSERT INTO support_requests ("userId", "isActive", "hasNewMessages") VALUES
(3, true, true),
(4, true, false),
(3, false, false)
ON CONFLICT DO NOTHING;

-- Тестовые сообщения
INSERT INTO messages ("authorId", "text", "supportRequestId", "readAt") VALUES
(3, 'Здравствуйте! У меня проблема с бронированием книги.', 1, NULL),
(2, 'Здравствуйте, Иван! Расскажите, какая именно проблема?', 1, '2024-01-18 10:30:00'),
(3, 'Когда пытаюсь забронировать "Войну и мир", система пишет "Ошибка доступа".', 1, NULL),
(4, 'Как продлить срок аренды книги?', 2, '2024-01-18 11:00:00'),
(2, 'Мария, вы можете продлить аренду в личном кабинете или обратиться в библиотеку.', 2, NULL),
(3, 'Спасибо, проблема решилась!', 3, '2024-01-17 15:45:00'),
(2, 'Рады были помочь!', 3, NULL);

-- Проверяем созданные данные
SELECT '=== ПОЛЬЗОВАТЕЛИ ===' as section;
SELECT _id, email, name, role FROM users ORDER BY _id;

SELECT '=== БИБЛИОТЕКИ ===' as section;
SELECT id, name, address FROM libraries ORDER BY id;

SELECT '=== КНИГИ ===' as section;
SELECT id, title, author, "availableCopies" as available FROM books ORDER BY id;

SELECT '=== ОБРАЩЕНИЯ В ПОДДЕРЖКУ ===' as section;
SELECT _id, "userId", "isActive", "hasNewMessages", "createdAt" FROM support_requests ORDER BY _id;

SELECT '=== СООБЩЕНИЯ ===' as section;
SELECT _id, "authorId", LEFT("text", 50) || '...' as preview, "supportRequestId", 
       CASE WHEN "readAt" IS NULL THEN 'не прочитано' ELSE 'прочитано' END as status
FROM messages ORDER BY "sentAt";
